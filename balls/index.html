<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Matter.js Circle Simulation</title>
    <!-- Load Matter.js from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.20.0/build/matter.min.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <canvas id="world"></canvas>
    <script>
      // module aliases
      const { Engine, Render, Runner, World, Bodies } = Matter;

      // create an engine and world
      const engine = Engine.create();
      const world = engine.world;

      // set canvas dimensions
      const width = 800;
      const height = 600;

      // create a renderer and bind it to our canvas
      const render = Render.create({
        element: document.body,
        engine: engine,
        canvas: document.getElementById("world"),
        options: {
          width: width,
          height: height,
          wireframes: false,
          background: "#fafafa",
        },
      });

      Render.run(render);
      const runner = Runner.create();
      Runner.run(runner, engine);

      // Container (circle) parameters
      const containerX = width / 2;
      const containerY = height / 2;
      const containerRadius = 250;

      // Create the container walls using small static segments
      const segments = 40;
      const wallThickness = 30;
      const walls = [];

      for (let i = 0; i < segments; i++) {
        const theta = (i / segments) * 2 * Math.PI;
        const nextTheta = ((i + 1) / segments) * 2 * Math.PI;
        const midTheta = (theta + nextTheta) / 2;
        const x = containerX + containerRadius * Math.cos(midTheta);
        const y = containerY + containerRadius * Math.sin(midTheta);
        // The length of each wall segment approximates the arc length 
        const wallLength = (2 * Math.PI * containerRadius) / segments;
        // Use midTheta as the rotation angle for a tangent wall segment
        const wall = Bodies.rectangle(x, y, wallThickness, wallLength, {
          isStatic: true,
          angle: midTheta,
          render: { fillStyle: "#2e2b44" },
        });
        walls.push(wall);
      }
      World.add(world, walls);

      // Create many small balls to bounce inside the container
      const balls = [];
      const ballRadius = 10;
      const ballCount = 50;

      for (let i = 0; i < ballCount; i++) {
        let placed = false;
        // Ensure each ball is placed within the container
        while (!placed) {
          const x = containerX + (Math.random() - 0.5) * (containerRadius - ballRadius * 2);
          const y = containerY + (Math.random() - 0.5) * (containerRadius - ballRadius * 2);
          if (Math.hypot(x - containerX, y - containerY) < containerRadius - ballRadius * 2) {
            const ball = Bodies.circle(x, y, ballRadius, {
              restitution: 0.9,
              friction: 0.005,
              render: { fillStyle: "#ff6f61" },
            });
            balls.push(ball);
            placed = true;
          }
        }
      }
      World.add(world, balls);

      // Adjust view to show entire scene
      Render.lookAt(render, {
        min: { x: 0, y: 0 },
        max: { x: width, y: height },
      });
    </script>
  </body>
</html>